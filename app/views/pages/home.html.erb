<div class="min-h-screen">
  <!-- Hero -->
  <section class="relative text-white overflow-hidden rounded-lg shadow-lg mb-8" style="background: url('/rooms/hero.jpg') center center / cover no-repeat; min-height: 330px;">
    <div class="absolute inset-0" style="background: linear-gradient(to right, rgba(0,0,0,0.7), rgba(0,0,0,0.5), transparent); z-index: 1;"></div>
    <div class="relative max-w-7xl mx-auto px-6 py-16 lg:py-24 flex items-center" style="min-height: 330px; z-index: 2;">
      <div class="lg:w-2/3">
        <h2 class="text-6xl font-extrabold tracking-tight drop-shadow-2xl leading-tight">Stay at <span class="text-white underline decoration-white/40 decoration-4"><%= defined?(@hotel) && @hotel.present? ? @hotel.name : 'Grand Plaza Hotel' %></span></h2>
        <p class="mt-6 text-xl text-white drop-shadow-lg leading-relaxed font-medium max-w-2xl">Comfortable rooms, friendly service, and an example demo to integrate with Voice AI assistants. Book your stay in seconds.</p>
        <div class="mt-10 flex gap-6">
          <a href="#booking" class="inline-flex items-center font-bold rounded-xl shadow-xl transition-all text-lg" style="padding: 1.25rem 2.5rem; background: var(--brand-indigo); color: #fff;">Book a Room</a>
          <a href="#rooms" class="inline-flex items-center px-8 py-4 border-2 border-white text-white rounded-xl hover:bg-white/20 hover:scale-105 transition-all font-bold text-lg backdrop-blur-sm">See Rooms</a>
        </div>
      </div>
    </div>
  </section>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Booking form -->
    <aside id="booking" class="lg:col-span-1">
      <div class="bg-white rounded-xl shadow p-6">
        <h3 class="text-2xl font-bold text-gray-900">Book your stay</h3>
        <p class="text-sm text-gray-500 mt-1">Quick reservation — secure a room in seconds.</p>

        <form id="booking-form" class="mt-6 space-y-4">
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-xs font-medium text-gray-700">Check-in</label>
              <input id="check-in" type="date" class="mt-1 block w-full rounded-md border-gray-200 shadow-sm p-2" />
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-700">Check-out</label>
              <input id="check-out" type="date" class="mt-1 block w-full rounded-md border-gray-200 shadow-sm p-2" />
            </div>
          </div>

          <div>
            <label class="block text-xs font-medium text-gray-700">Room</label>
            <select id="room-select" class="mt-1 block w-full rounded-md border-gray-200 p-2">
              <option value="">Choose a room</option>
              <% @rooms.each do |room| %>
                <option value="<%= room.id %>" data-price="<%= room.price_per_night %>"><%= room.name %> — $<%= room.price_per_night %>/night</option>
              <% end %>
            </select>
          </div>

          <div>
            <label class="block text-xs font-medium text-gray-700">Guest name</label>
            <input id="guest-name" type="text" class="mt-1 block w-full rounded-md border-gray-200 p-2" placeholder="Your full name" />
          </div>

          <div>
            <label class="block text-xs font-medium text-gray-700">Email</label>
            <input id="guest-email" type="email" class="mt-1 block w-full rounded-md border-gray-200 p-2" placeholder="you@example.com" />
          </div>

          <div id="price-info" class="hidden p-3 rounded-md bg-indigo-50 text-indigo-900">
            <div class="flex justify-between items-center">
              <div class="text-sm">Estimated total</div>
              <div id="total-price" class="text-lg font-bold">$0.00</div>
            </div>
          </div>

          <button type="submit" class="w-full mt-2 inline-flex justify-center items-center px-4 py-2 bg-indigo-600 text-white font-semibold rounded-md hover:bg-indigo-700">Reserve</button>
        </form>
      </div>
    </aside>

    <!-- Rooms list -->
    <section id="rooms" class="lg:col-span-2 space-y-6">
      <div class="flex items-center justify-between">
        <h3 class="text-2xl font-bold">Available rooms</h3>
        <p class="text-sm text-gray-500">Select a room to auto-fill the booking form</p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <% @rooms.each do |room| %>
          <article class="bg-white rounded-xl shadow overflow-hidden flex flex-col">
            <!-- Header with background image -->
            <div class="h-48 bg-gray-200 relative" style="background-image: url('<%= room_image_path(room) %>'); background-size: cover; background-position: center;">
              <div class="absolute inset-0 bg-black/30"></div>
            </div>
            <!-- Content section -->
            <div class="p-5 flex flex-col justify-between flex-1">
              <div>
                <h4 class="text-2xl font-bold text-gray-900"><%= room.name %></h4>
                <p class="text-sm text-gray-600 mt-1">Capacity: <%= room.capacity %> guest<%= room.capacity > 1 ? 's' : '' %></p>
              </div>
              <div class="mt-4 flex items-center justify-between">
                <div>
                  <div class="text-3xl font-bold text-indigo-600">$<%= room.price_per_night %></div>
                  <div class="text-sm text-gray-500">per night</div>
                </div>
              </div>
              <div class="mt-4 flex gap-2">
                <button data-room-id="<%= room.id %>" data-room-price="<%= room.price_per_night %>" class="select-room-btn flex-1 inline-flex justify-center items-center px-4 py-2 border border-indigo-600 text-indigo-600 rounded-md text-sm hover:bg-indigo-50 font-semibold">Select Room</button>
                <a href="#" class="flex-1 inline-flex justify-center items-center px-4 py-2 bg-indigo-600 text-white rounded-md text-sm hover:bg-indigo-700 font-semibold">Details</a>
              </div>
            </div>
          </article>
        <% end %>
      </div>
    </section>
  </div>

  <script>
    // wire up select buttons to fill form
    document.querySelectorAll('.select-room-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.dataset.roomId;
        document.getElementById('room-select').value = id;
        document.getElementById('room-select').dispatchEvent(new Event('change'));
        document.getElementById('booking').scrollIntoView({behavior: 'smooth'});
      });
    });

    const updatePrice = () => {
      const checkIn = document.getElementById('check-in').value;
      const checkOut = document.getElementById('check-out').value;
      const roomSelect = document.getElementById('room-select');
      if (!checkIn || !checkOut || !roomSelect.value) { document.getElementById('price-info').classList.add('hidden'); return; }
      const start = new Date(checkIn);
      const end = new Date(checkOut);
      const nights = Math.round((end - start) / (1000*60*60*24));
      if (nights <= 0) { document.getElementById('price-info').classList.add('hidden'); return; }
      const price = parseFloat(roomSelect.selectedOptions[0].dataset.price || 0);
      const total = (nights * price).toFixed(2);
      document.getElementById('total-price').textContent = `$${total}`;
      document.getElementById('price-info').classList.remove('hidden');
    };

    ['change','input'].forEach(ev => {
      document.getElementById('check-in').addEventListener(ev, updatePrice);
      document.getElementById('check-out').addEventListener(ev, updatePrice);
      document.getElementById('room-select').addEventListener(ev, updatePrice);
    });

    document.getElementById('booking-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const payload = { booking: {
        room_id: document.getElementById('room-select').value,
        guest_name: document.getElementById('guest-name').value,
        guest_email: document.getElementById('guest-email').value,
        check_in: document.getElementById('check-in').value,
        check_out: document.getElementById('check-out').value
      }};
      try {
        const res = await fetch('/api/bookings', {
          method: 'POST', headers: {'Content-Type':'application/json','X-CSRF-Token': document.querySelector('[name="csrf-token"]').content}, body: JSON.stringify(payload)
        });
        const data = await res.json();
        if (data.success) { window.location.href = `/confirmation/${data.booking.id}`; }
        else { alert('Booking failed: ' + (data.errors || data.error || []).join ? data.errors.join(', ') : JSON.stringify(data)); }
      } catch(err){ alert('Network error: '+err.message); }
    });
  </script>
</div>
